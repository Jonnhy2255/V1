<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App Prédictions Premier League</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f6f6f6;
            margin: 0;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .match-card {
            background: #fff;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .teams {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .team-name {
            font-weight: bold;
            font-size: 18px;
        }
        .date {
            font-size: 14px;
            color: #777;
        }
        .prediction {
            margin-top: 10px;
            font-size: 16px;
            color: #2a9d8f;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Prédictions Premier League</h1>
    <div id="matches"></div>

    <script>
        const API_KEY = '097484f1d09ec785f42ad0be238ffabf';
        const BASE_URL = 'https://v3.football.api-sports.io';
        const LEAGUE_ID = 39;
        const SEASON = 2024;

        const headers = {
            'x-rapidapi-host': 'v3.football.api-sports.io',
            'x-rapidapi-key': API_KEY
        };

        async function getUpcomingMatches() {
            const res = await fetch(`${BASE_URL}/fixtures?league=${LEAGUE_ID}&season=${SEASON}&next=3`, { headers });
            const data = await res.json();
            return data.response;
        }

        async function getStandings() {
            const res = await fetch(`${BASE_URL}/standings?league=${LEAGUE_ID}&season=${SEASON}`, { headers });
            const data = await res.json();
            const standings = {};
            data.response[0].league.standings[0].forEach(team => {
                standings[team.team.id] = team.rank;
            });
            return standings;
        }

        async function getLastMatches(teamId) {
            const res = await fetch(`${BASE_URL}/fixtures?team=${teamId}&last=5`, { headers });
            const data = await res.json();
            return data.response;
        }

        function calculateForm(matches, teamId) {
            let points = 0;
            matches.forEach(match => {
                const isHome = match.teams.home.id === teamId;
                const goalsFor = isHome ? match.goals.home : match.goals.away;
                const goalsAgainst = isHome ? match.goals.away : match.goals.home;

                if (goalsFor > goalsAgainst) points += 3;
                else if (goalsFor === goalsAgainst) points += 1;
            });
            return points;
        }

        function predictWinner(homeRank, awayRank, homeForm, awayForm, homeName, awayName) {
            let score = 0;
            if (homeRank < awayRank) score += 1;
            else if (homeRank > awayRank) score -=1;

            if (homeForm > awayForm) score +=1;
            else if (homeForm < awayForm) score -=1;

            if (score > 0) return homeName;
            else if (score < 0) return awayName;
            else return 'Match nul';
        }

        async function displayMatches() {
            const matchesDiv = document.getElementById('matches');
            const standings = await getStandings();
            const matches = await getUpcomingMatches();

            for (const match of matches) {
                const home = match.teams.home;
                const away = match.teams.away;
                const date = new Date(match.fixture.date).toLocaleString('fr-FR');

                const homeLast = await getLastMatches(home.id);
                const awayLast = await getLastMatches(away.id);

                const homeForm = calculateForm(homeLast, home.id);
                const awayForm = calculateForm(awayLast, away.id);

                const homeRank = standings[home.id];
                const awayRank = standings[away.id];

                const prediction = predictWinner(homeRank, awayRank, homeForm, awayForm, home.name, away.name);

                const card = document.createElement('div');
                card.className = 'match-card';
                card.innerHTML = `
                    <div class="teams">
                        <div>
                            <div class="team-name">${home.name}</div>
                            <div class="rank">Classement: ${homeRank}</div>
                            <div class="form">Forme (5 derniers): ${homeForm} pts</div>
                        </div>
                        <div>
                            <div class="date">${date}</div>
                        </div>
                        <div>
                            <div class="team-name">${away.name}</div>
                            <div class="rank">Classement: ${awayRank}</div>
                            <div class="form">Forme (5 derniers): ${awayForm} pts</div>
                        </div>
                    </div>
                    <div class="prediction">Prédiction: ${prediction}</div>
                `;
                matchesDiv.appendChild(card);
            }
        }

        displayMatches();
    </script>
</body>
</html>
